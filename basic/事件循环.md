#### JavaScript的单线程

JavaScript是单线程的，同一时间只能做一件事，提高了效率，但是并发处理能力差，于是任务的执行模式就分为了两种：同步任务和异步任务，通过事件循环处理任务

- 同步任务

主线程上排队执行的任务，前一个任务执行完了才执行下一个

- 异步任务

不进入主线程、而进入任务队列，只有任务通知主线程，某个任务可以执行了，该任务才会进入主线程执行

- 宏任务

在任务队列的最顶端，每个宏任务都会重新开启一个任务队列，如主代码块、setTimeout、setInterval

- 微任务

在任务队列的最底端，主线程的同步任务执行结束后可以立即执行的任务，如promise、process-nextTick

#### 过程

- 所有同步任务先在主线程上执行，形成一个执行栈

- 主线程之外有一个任务队列，一旦执行栈执行完毕后，就读取任务队列中的第一个异步任务，这个异步任务就结束等待，进入主线程开始执行

- 主线程不断重复第二步

> 微任务中的微任务优先于之后并行的微任务；外层的宏任务优先于内层的宏任务

示例如下，输出1、2、3、4、5

```js
setTimeout(function(){
    setTimeout(function(){
        console.log(5); // 第三个任务队列的第一个任务
    });
    Promise.resolve().then(function(){
        console.log(1); // 同步执行
        new Promise(function(resolve){
            resolve();
        }).then(function(){
            console.log(3); // 第一个任务队列的第二个任务
        })
    });
    Promise.resolve().then(function(){
        console.log(2); // 第一个任务队列的第一个任务
    })
});

setTimeout(function(){
    console.log(4); // 第二个任务队列的第一个任务
})
```